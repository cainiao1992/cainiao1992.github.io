<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >

<title>Gitea - ä»£ç é¡¹ç›®ç®¡ç† | èœé¸Ÿçš„ç¬”è®°</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://cainiao1992.github.io/favicon.ico?v=1700885120829">
<link rel="stylesheet" href="https://cainiao1992.github.io/styles/main.css">



<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>



    <meta name="description" content="Gitea å®‰è£…éƒ¨ç½²
é…ç½® SSH ç›´é€šï¼ˆå¯é€‰ï¼Œä¸éœ€è¦ SSH åè®®åŒæ­¥æ— éœ€æ­¤æ­¥éª¤ï¼Œå¯ä»¥ä½¿ç”¨ https/http åè®®åŒæ­¥ä»£æ›¿ï¼‰
# è®°å½•ä¸‹ UID/GID æ›¿æ¢ä¸­çš„ USER_UID USER_GID
sudo adduser --sy..." />
    <meta name="keywords" content="Docker,ç¬”è®°" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://cainiao1992.github.io">
        <img src="https://cainiao1992.github.io/images/avatar.png?v=1700885120829" class="site-logo">
        <h1 class="site-title">èœé¸Ÿçš„ç¬”è®°</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="/" class="site-nav">
            é¦–é¡µ
          </a>
        
      
        
          <a href="/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
        
          <a href="/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="/post/about" class="site-nav">
            å…³äº
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      æ¸©æ•…è€ŒçŸ¥æ–°
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/getgridea/gridea" target="_blank">Gridea</a> | <a class="rss" href="https://cainiao1992.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">Gitea - ä»£ç é¡¹ç›®ç®¡ç†</h2>
            <div class="post-date">2023-08-27</div>
            
            <div class="post-content" v-pre>
              <h1 id="gitea-å®‰è£…éƒ¨ç½²">Gitea å®‰è£…éƒ¨ç½²</h1>
<h2 id="é…ç½®-ssh-ç›´é€šå¯é€‰ä¸éœ€è¦-ssh-åè®®åŒæ­¥æ— éœ€æ­¤æ­¥éª¤å¯ä»¥ä½¿ç”¨-httpshttp-åè®®åŒæ­¥ä»£æ›¿">é…ç½® SSH ç›´é€šï¼ˆå¯é€‰ï¼Œä¸éœ€è¦ SSH åè®®åŒæ­¥æ— éœ€æ­¤æ­¥éª¤ï¼Œå¯ä»¥ä½¿ç”¨ https/http åè®®åŒæ­¥ä»£æ›¿ï¼‰</h2>
<pre><code class="language-bash"># è®°å½•ä¸‹ UID/GID æ›¿æ¢ä¸­çš„ USER_UID USER_GID
sudo adduser --system --shell /bin/bash --gecos 'Git Version Control' --group --disabled-password --home /home/git git
# ç”Ÿæˆ SSH å¯†é’¥å¯¹
sudo -u git ssh-keygen -t rsa -b 4096 -C &quot;Gitea Host Key&quot;

# ----------------------------------------------------------------

sudo -u git cat /home/git/.ssh/id_rsa.pub | sudo -u git tee -a /home/git/.ssh/authorized_keys
sudo -u git chmod 600 /home/git/.ssh/authorized_keys

cat &lt;&lt;&quot;EOF&quot; | sudo tee /usr/local/bin/gitea
#!/bin/sh
ssh -p 2222 -o StrictHostKeyChecking=no git@127.0.0.1 &quot;SSH_ORIGINAL_COMMAND=\&quot;$SSH_ORIGINAL_COMMAND\&quot; $0 $@&quot;
EOF
sudo chmod +x /usr/local/bin/gitea
</code></pre>
<h2 id="docker-compose-å®‰è£…éƒ¨ç½²">docker-compose å®‰è£…éƒ¨ç½²</h2>
<ul>
<li>docker-compose.yml</li>
</ul>
<pre><code class="language-yaml">version: &quot;3&quot;

services:
  caddy:
    container_name: caddy
    image: caddy:alpine
    restart: unless-stopped
    ports:
      - &quot;80:80&quot;
      - &quot;80:80/udp&quot;
      - &quot;443:443&quot;
      - &quot;443:443/udp&quot;
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile
  gitea:
    container_name: gitea
    image: gitea/gitea:latest
    restart: unless-stopped
    # depends_on:
    #   - redis
    environment:
      - USER=git
      - USER_UID=111
      - USER_GID=122
    volumes:
      - ./gitea:/data
      - /home/git/.ssh:/data/git/.ssh
      - /etc/timezone:/etc/timezone:ro
      - /etc/localtime:/etc/localtime:ro
    ports:
      - &quot;127.0.0.1:2222:22&quot;


  # redis:
  #   container_name: redis
  #   image: redis:alpine
  #   restart: unless-stopped
  #   volumes:
  #     - ./redis:/data
</code></pre>
<ul>
<li>Caddyfile</li>
</ul>
<pre><code class="language-Caddyfile">:80 {
  redir https://{host}{uri}
}
gitea.uing.vip {
  log {
    output stdout
    format console
    level  ERROR
  }
  reverse_proxy gitea:3000
}
</code></pre>
<h2 id="å¯ç”¨-gitea-actions-å†…ç½®çš„-cicd-æŒç»­é›†æˆ-æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²è§£å†³æ–¹æ¡ˆ">å¯ç”¨ Gitea Actions å†…ç½®çš„ CI/CD ï¼ˆæŒç»­é›†æˆã€æŒç»­äº¤ä»˜å’ŒæŒç»­éƒ¨ç½²ï¼‰è§£å†³æ–¹æ¡ˆ</h2>
<h3 id="é…ç½®-gitea-æœåŠ¡å™¨">é…ç½® Gitea æœåŠ¡å™¨</h3>
<pre><code class="language-bash">cat &lt;&lt; EOF &gt;&gt; gitea/gitea/conf/app.ini
[actions]
ENABLED=true
EOF
docker-compose restart gitea
</code></pre>
<h3 id="ç”Ÿæˆ-gitea-runner-é…ç½®æ–‡ä»¶">ç”Ÿæˆ  Gitea Runner é…ç½®æ–‡ä»¶</h3>
<pre><code>mkdir gitea_runner &amp;&amp; cd gitea_runner
docker run --entrypoint=&quot;&quot; --rm -it gitea/act_runner:latest act_runner generate-config &gt; config.yaml
</code></pre>
<h3 id="docker-compose-å®‰è£…-gitea-runner-éƒ¨ç½²">docker-compose å®‰è£… Gitea Runner éƒ¨ç½²</h3>
<ul>
<li>docker-compose.yml</li>
</ul>
<pre><code class="language-yaml">version: &quot;3&quot;

services:
  gitea_runner:
    container_name: gitea_runner
    image: gitea/act_runner:latest
    # å¦‚æœä½¿ç”¨æœåŠ¡å™¨å®¹å™¨åç§°ä½œä¸º URL HOST çš„è¯ï¼Œéœ€è¦å…ˆå¯åŠ¨ Gitea
    depends_on:
      - gitea
    environment:
      CONFIG_FILE: /config.yaml
      # Gitea æœåŠ¡å™¨åœ°å€ï¼ˆä¹Ÿå¯ä»¥æ˜¯å†…ç½‘åœ°å€æˆ–è€…å®¹å™¨å†…éƒ¨åœ°å€ï¼‰
      GITEA_INSTANCE_URL: https://gitea.uing.vip
      # è·å–åœ°å€ https://gitea.uing.vip/admin/actions/runners/
      GITEA_RUNNER_REGISTRATION_TOKEN: &quot;&quot;
      # Runneråç§°ï¼ˆå¯é€‰ï¼‰ã€‚å¦‚æœç•™ç©ºï¼Œå°†ä½¿ç”¨ä¸»æœºå
      GITEA_RUNNER_NAME: &quot;&quot;
      GITEA_RUNNER_LABELS: &quot;&quot;
    volumes:
      - ./gitea_runner/config.yaml:/config.yaml
      - ./gitea_runner/data:/data
      - /var/run/docker.sock:/var/run/docker.sock
</code></pre>
<h2 id="é…ç½®ä»“åº“å¯ç”¨-gitea-actions">é…ç½®ä»“åº“å¯ç”¨ Gitea Actions</h2>
<ol>
<li>æ‰“å¼€ä»“åº“è®¾ç½® https://gitea.uing.vip/&lt;owner&gt;/&lt;repo&gt;/settings</li>
<li>æ‰¾åˆ°å¹¶å‹¾é€‰ <strong>å¯ç”¨ Actions</strong> ï¼Œå¹¶ <strong>æ›´æ–°ä»“åº“è®¾ç½®</strong> ä¿å­˜è®¾ç½®<br>
<img src="https://cainiao1992.github.io/post-images/1693367900388.png" alt="enable_actions" loading="lazy"></li>
<li>åœ¨ä»“åº“ä»£ç ä¸‹æ–°å»ºç›®å½• <strong>.gitea/workflows/</strong>ï¼Œæ–°å»º Yaml æ–‡ä»¶ç¼–å†™ Gitea Actions æ‰§è¡Œä»£ç </li>
</ol>
<pre><code class="language-bash">git clone git@gitea.uing.vip:cainiao/gitea_runner.git

cd gitea_runner &amp;&amp; mkdir -p .gitea/workflows/

cat &lt;&lt;&quot;EOF&quot; &gt; .gitea/workflows/demo.yaml
name: Gitea Actions Demo
run-name: ${{ gitea.actor }} is testing out Gitea Actions ğŸš€
on: [push]

jobs:
  Explore-Gitea-Actions:
    runs-on: ubuntu-latest
    steps:
      - run: echo &quot;ğŸ‰ The job was automatically triggered by a ${{ gitea.event_name }} event.&quot;
      - run: echo &quot;ğŸ§ This job is now running on a ${{ runner.os }} server hosted by Gitea!&quot;
      - run: echo &quot;ğŸ” The name of your branch is ${{ gitea.ref }} and your repository is ${{ gitea.repository }}.&quot;
      - name: Check out repository code
        uses: actions/checkout@v3
      - run: echo &quot;ğŸ’¡ The ${{ gitea.repository }} repository has been cloned to the runner.&quot;
      - run: echo &quot;ğŸ–¥ï¸ The workflow is now ready to test your code on the runner.&quot;
      - name: List files in the repository
        run: |
          ls ${{ gitea.workspace }}
      - run: echo &quot;ğŸ This job's status is ${{ job.status }}.&quot;
EOF

git add .gitea/workflows/demo.yaml
git commit -m &quot;add .gitea/workflows/demo.yaml&quot;
git push
</code></pre>
<ol start="4">
<li>åœ¨ä»“åº“çš„ Actions ä¸‹æŸ¥çœ‹åˆ°æ‰§è¡Œè¿‡ç¨‹åŠç»“æœï¼šhttps://gitea.uing.vip/&lt;owner&gt;/&lt;repo&gt;/actions</li>
</ol>
<h2 id="ç›¸å…³è¿æ¥">ç›¸å…³è¿æ¥</h2>
<ul>
<li>(Configuration Cheat Sheet)[https://docs.gitea.com/administration/config-cheat-sheet]</li>
</ul>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://cainiao1992.github.io/tag/yPbchiAoj/" class="tag">
                    Docker
                  </a>
                
                  <a href="https://cainiao1992.github.io/tag/TC9QunWVT-/" class="tag">
                    ç¬”è®°
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://cainiao1992.github.io/post/git/">
                  <h3 class="post-title">
                    Git ä½¿ç”¨ç¬”è®°
                  </h3>
                </a>
              </div>
            

            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="//cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.5.1/build/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>





  </body>
</html>
